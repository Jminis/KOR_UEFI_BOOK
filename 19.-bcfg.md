# 19. bcfg 명령을 사용한 부팅 옵션 수정

ㅇㅇㅇㅇ

이전에OVMF 빌드로 생성된 파일이 있다.

```
$ ls -l Build/OvmfX64/RELEASE_GCC5/FV/OVMF*
-rw-rw-r-- 1 ubuntu ubuntu 3653632 11월 23 17:51 Build/OvmfX64/RELEASE_GCC5/FV/OVMF_CODE.fd
-rw-rw-r-- 1 ubuntu ubuntu 4194304 11월 24 10:23 Build/OvmfX64/RELEASE_GCC5/FV/OVMF.fd
-rw-rw-r-- 1 ubuntu ubuntu  540672 11월 23 21:10 Build/OvmfX64/RELEASE_GCC5/FV/OVMF_VARS.fd
```

* `OVMF_CODE.fd` - code image (read-only)
* `OVMF_VARS.fd` - NVRAM variables image (read-write)
* `OVMF.fd` - combined image (`OVMF_CODE.fd` + `OVMF_VARS.fd`)

위 파일들을 이용해서 QEMU를 실행하는 2가지 방법이 있다.

`OVMF.fd` 파일 하나만 사용하는 방법

```
$ qemu-system-x86_64 -drive if=pflash,format=raw,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF.fd \
                     ...
```

`OVMF_CODE.fd` 와 `OVMF_VARS.fd` 를 사용한 방법

```
$ qemu-system-x86_64 -drive if=pflash,format=raw,readonly,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF_CODE.fd \
                     -drive if=pflash,format=raw,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF_VARS.fd \
                     ...
```

이전에는 짧게 `OVMF.fd` 파일만을 이용해서 진행했지만, 여기서는 NVRAM 변수를 수정할 것이기 때문에 초기 상태로 되돌릴 수 있도록`OVMF_NVRAM.fd` 파일을 복사하여 진행한다.

먼저 이전에 OVMF에 HelloWorld 앱을 넣었기 때문에 OVMF 패키지부터 초기 상태로 되돌린다.

```
$ git restore OvmfPkg
$ build --platform=OvmfPkg/OvmfPkgX64.dsc --arch=X64 --buildtarget=RELEASE --tagname=GCC5
```

OVMF를 초기 상태로 빌드하였기 때문에 이제 `OVMF_VARS.fd`를 복사한 후 복사한 파일을 사용하여 QEMU를 실행한다.

```
$ cp Build/OvmfX64/RELEASE_GCC5/FV/OVMF_VARS.fd ../
$ qemu-system-x86_64 -drive if=pflash,format=raw,readonly,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF_CODE.fd \
                     -drive if=pflash,format=raw,file=../OVMF_VARS.fd \
                     -drive format=raw,file=fat:rw:~/UEFI_disk \
                     -nographic \
                     -net none
```

NVRAM 변수를 변경하기 전에 `bcfg boot dump` 명령을 통해 확인한다.

```
Shell> bcfg boot dump
Option: 00. Variable: Boot0000
  Desc    - UiApp
  DevPath - Fv(7CB8BDC9-F8EB-4F34-AAEA-3EE4AF6516A1)/FvFile(462CAA21-7614-4503-836E-8AB6F4662331)
  OVMF_VARS.fdiOptional- N
Option: 01. Variable: Boot0001
  Desc    - UEFI QEMU DVD-ROM QM00003
  DevPath - PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)
  Optional- Y
Option: 02. Variable: Boot0002
  Desc    - UEFI QEMU HARDDISK QM00001
  DevPath - PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)
  Optional- Y
Option: 03. Variable: Boot0003
  Desc    - EFI Internal Shell
  DevPath - Fv(7CB8BDC9-F8EB-4F34-AAEA-3EE4AF6516A1)/FvFile(7C04A583-9E3E-4F1C-AD65-E05268D0B4D1)
  Optional- N
```
